

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Geometry &mdash; SAXS 1.0.1 alpha documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="SAXS 1.0.1 alpha documentation" href="index.html"/>
        <link rel="up" title="The Technology" href="TheTechnology.html"/>
        <link rel="next" title="Polarization Correction" href="PolCorr.html"/>
        <link rel="prev" title="Integration as Matrix-Vector Multiplication" href="MatrixMulti.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> SAXS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="TheTools.html">The Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="TheTools.html#the-saxsdog">The Saxsdog</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheTools.html#the-converter">The Converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheTools.html#plotchi">Plotchi</a></li>
<li class="toctree-l2"><a class="reference internal" href="TheTools.html#saxsdmerge">Saxsdmerge</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SAXSSchemaDoc.html">The Calibration File</a><ul>
<li class="toctree-l2"><a class="reference internal" href="SAXSSchemaDoc.html#calibration-file-reference">Calibration file Reference</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="TheTechnology.html">The Technology</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="MatrixMulti.html">Integration as Matrix-Vector Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="MatrixMulti.html#over-sampling">Over sampling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">The Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="PolCorr.html">Polarization Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fit2d.html">Compare With Fit2d</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConstantImage.html">Integrating a Constant Image With Masked Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="Statistics.html">Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Server.html">The Saxsdog Network</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Server.html#the-saxsnetwork-configuration">The SAXSNetwork configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="Server.html#the-saxsdog-server">The Saxsdog Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="Server.html#the-saxs-leash">The Saxs Leash</a></li>
<li class="toctree-l2"><a class="reference internal" href="Server.html#saxs-leash-commandline">Saxs Leash Commandline</a></li>
<li class="toctree-l2"><a class="reference internal" href="Server.html#the-saxsdog-network-protocol">The Saxsdog Network Protocol</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SAXSapi.html">SAXS Module API</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">SAXS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="TheTechnology.html">The Technology</a> &raquo;</li>
      
    <li>The Geometry</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/Geometry.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="the-geometry">
<span id="geometry"></span><h1>The Geometry<a class="headerlink" href="#the-geometry" title="Permalink to this headline">¶</a></h1>
<p>The plane of the sensor is not perfectly normal to the beam. So in order to calculate witch
pixel is on witch cone in the diffracted light, we need to express the geometry somehow.</p>
<p>Every pixel has the polar coordinates <span class="math">\(r\)</span>, <span class="math">\(\phi\)</span> with the projected diffraction center in the origin.
For each pixel (P) the triangle S,C,P (Sample, Center, Pixel, <span class="math">\(\theta\)</span>, <span class="math">\(\beta\)</span>, <span class="math">\(\gamma\)</span>)
can be fully expressed with the law of cosines.</p>
<div class="figure">
<img src="_images/Dreieck.svg" /><p class="caption">The SCP triangle.</p>
</div>
<p><span class="math">\(l\)</span> is the distance the light travels from the diffraction center to the sensor.</p>
<div class="math">
\[l^2=d^2+r^2 - 2 d r \cos(\pi/2+\alpha)\]</div>
<p><span class="math">\(r\)</span> is the radial coordinate of the pixel P.</p>
<div class="math">
\[r^2=l^2+d^2 -2 l d \cos(\theta)\]</div>
<p>from these two formulas the diffraction angle (here) <span class="math">\(\theta\)</span> can be computed.</p>
<div class="math">
\[\theta=\arccos(-r^2 -l^2 -d^2 2 l d)\]</div>
<div class="figure" id="alpha">
<img src="_images/winkel.svg" /><p class="caption">Angle between two planes.</p>
</div>
<p><span class="math">\(\alpha\)</span> comes from the following relation in figure <a class="reference internal" href="#alpha"><em>Angle between two planes.</em></a></p>
<p>The angle between the sensor plane and the normal plane to the ray is given by <span class="math">\(\tau\)</span>.
The slope <span class="math">\(s\)</span> derived from  <span class="math">\(\tau\)</span> is</p>
<div class="math">
\[s=\sin(\tau)\]</div>
<p>On the (red) unit circle in the plane of the sensor the distance to the plane normal to the ray is expressed as</p>
<div class="math">
\[h=\sin(\phi)s\]</div>
<p>The angle <span class="math">\(\alpha\)</span> is therefore:</p>
<div class="math">
\[\alpha=\arcsin(\sin(\tau)\sin(\phi))\]</div>
<p>in Python code this is <a class="reference internal" href="SAXSapi.html#SAXS.calc_theta" title="SAXS.calc_theta"><tt class="xref py py-func docutils literal"><span class="pre">SAXS.calc_theta()</span></tt></a>:</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">calc_theta</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">tilt</span><span class="p">,</span><span class="n">tiltdir</span><span class="p">):</span>
   <span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">tiltdir</span><span class="p">))</span>
   <span class="n">lsquared</span><span class="o">=</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">alpha</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">lsquared</span><span class="o">-</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lsquared</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">))</span>
</pre></div>
</div>
<p>This angle <span class="math">\(\theta\)</span> then is calculated for every sub pixel in the sensor.
This number then can be rescaled and rounded to the nearest integer in order to get
unique integer labels for all the pixels. This labels are the index of the radial interval.</p>
<div class="section" id="tilt-angle-correction-test">
<h2>Tilt Angle Correction Test<a class="headerlink" href="#tilt-angle-correction-test" title="Permalink to this headline">¶</a></h2>
<p>To check if the tilt angle correction is working, lets create some fake calibration data, with the following peaks
in the diffraction curve:</p>
<p>(<a class="reference external" href=".//Geometry-1.py">Source code</a>, <a class="reference external" href=".//Geometry-1.png">png</a>, <a class="reference external" href=".//Geometry-1.hires.png">hires.png</a>, <a class="reference external" href=".//Geometry-1.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/Geometry-1.png" src="_images/Geometry-1.png" />
</div>
<p>(<a class="reference external" href=".//Geometry-2.py">Source code</a>, <a class="reference external" href=".//Geometry-2.png">png</a>, <a class="reference external" href=".//Geometry-2.hires.png">hires.png</a>, <a class="reference external" href=".//Geometry-2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/Geometry-2.png" src="_images/Geometry-2.png" />
</div>
<p>This was done with this configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&quot;PixelPerRadialElement&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&quot;Imagesize&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="mi">1043</span><span class="p">,</span>
        <span class="mi">981</span>
    <span class="p">],</span>
    <span class="s">&quot;Tilt&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;TiltAngleDeg&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
        <span class="s">&quot;TiltRotDeg&quot;</span><span class="p">:</span> <span class="mf">73.569</span>
    <span class="p">},</span>
    <span class="s">&quot;MaskFile&quot;</span><span class="p">:</span> <span class="s">&quot;emptymask.tif&quot;</span><span class="p">,</span>
    <span class="s">&quot;PixelSizeMicroM&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="mf">172.0</span><span class="p">,</span>
        <span class="mf">172.0</span>
    <span class="p">],</span>
    <span class="s">&quot;Wavelength&quot;</span><span class="p">:</span> <span class="mf">1.54</span><span class="p">,</span>
    <span class="s">&quot;DedectorDistanceMM&quot;</span><span class="p">:</span> <span class="mf">1031.657</span><span class="p">,</span>
    <span class="s">&quot;BeamCenter&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="mf">808.37</span><span class="p">,</span>
        <span class="mf">387.772</span>
    <span class="p">],</span>
    <span class="s">&quot;Oversampling&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which amounts to a large tilt, lets see what Fit2d makes of it</p>
<div class="code highlight-python"><div class="highlight"><pre>INFO: SOLUTION 2
INFO: Best fit beam centre (X/Y mm) =   66.78356      138.9544
INFO: Best fit beam centre (X/Y pixels) =   388.2765      807.8745
INFO: Cone  1 best fit 2 theta angle (degrees) =   1.392646
INFO: Cone  2 best fit 2 theta angle (degrees) =   2.780810
INFO: Cone  3 best fit 2 theta angle (degrees) =   4.168858
INFO: Cone  4 best fit 2 theta angle (degrees) =   5.556975
INFO: Cone  5 best fit 2 theta angle (degrees) =   6.944765
INFO: Best fit angle of tilt plane rotation (degrees) =   73.59509
INFO: Best fit angle of tilt (degrees) =  -10.00601
INFO: Estimated coordinate radial position error (mm) =  0.7136476E-02
INFO: Estimated coordinate radial position error (X pixels) =  0.4149114E-01
</pre></div>
</div>
<p>Seems OK.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="PolCorr.html" class="btn btn-neutral float-right" title="Polarization Correction"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="MatrixMulti.html" class="btn btn-neutral" title="Integration as Matrix-Vector Multiplication"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright  2014, Tu Graz, Christian Meisenbichler, Heinz Amenitsch.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.1 alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>